(()=>{"use strict";var t,e,n,s,i,a=function(t,e,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(t):s?s.value:e.get(t)},r=function(t,e,n,s,i){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?i.call(t,n):i?i.value=n:e.set(t,n),n};class o{static get minLength(){return a(o,t,"f",e)}static get maxLength(){return a(o,t,"f",n)}constructor(l){if(s.set(this,void 0),i.set(this,void 0),l<a(o,t,"f",e)||l>a(o,t,"f",n))throw new Error("Ship length out of bounds: "+l);r(this,s,l,"f"),r(this,i,0,"f")}get length(){return a(this,s,"f")}get isSunk(){return a(this,s,"f")<=a(this,i,"f")}hit(){var t;this.isSunk||r(this,i,(t=a(this,i,"f"),++t),"f")}}t=o,s=new WeakMap,i=new WeakMap,e={value:1},n={value:5};var l,c,u,d,h,f,p,m,y,w=function(t,e,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(t):s?s.value:e.get(t)},g=function(t,e,n,s,i){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?i.call(t,n):i?i.value=n:e.set(t,n),n};class S{static get Size(){return w(S,c,"f",u)}constructor(){l.add(this),d.set(this,void 0),h.set(this,void 0),g(this,d,[],"f"),g(this,h,[],"f");for(let t=0;t<w(S,c,"f",u);t++){const t=[];for(let e=0;e<w(S,c,"f",u);e++)t.push({shipId:-1,isFog:!0,isClear:!1});w(this,h,"f").push(t)}}get ships(){return w(this,d,"f")}get allAreSunk(){return w(this,d,"f").every((t=>t.isSunk))}randomize(t){for(const e of t){const t=new o(e);let n,s,i;do{n=Math.round(9*Math.random()),s=Math.round(9*Math.random()),i=Math.random()>.5?"horizontal":"vertical"}while(!w(this,l,"m",m).call(this,t,n,s,i));this.place(t,n,s,i)}}isShip(t,e){return w(this,h,"f")[t][e].shipId>=0}getState(t,e){w(this,l,"m",y).call(this,t,e);const n=w(this,h,"f")[t][e];return n.isFog?"fog":-1===n.shipId?"water":w(this,d,"f")[n.shipId].isSunk?"sunk":"hit"}place(t,e,n,s){if(w(this,l,"m",y).call(this,e,n),!w(this,l,"m",m).call(this,t,e,n,s))throw new Error(`Invalid ship placement: ${e}, ${n}`);w(this,d,"f").push(t);const i=w(this,d,"f").length-1;for(let a=0;a<t.length;a++)"horizontal"===s?w(this,h,"f")[e+a][n].shipId=i:w(this,h,"f")[e][n+a].shipId=i}attack(t,e){w(this,l,"m",y).call(this,t,e);const n=w(this,h,"f")[t][e];if(!n.isFog)throw new Error(`Cell already received an attack: ${t}, ${e}`);if(n.isFog=!1,n.shipId<0)return;const s=w(this,d,"f")[n.shipId];s.hit(),s.isSunk&&w(this,l,"m",f).call(this,t,e)}}function v(t,e){e.innerHTML="";for(let n=0;n<t.length;n++){const s=document.createElement("div");s.classList.add("ship"),s.setAttribute("data-id",""+n),e.appendChild(s);for(let e=0;e<t[n].length;e++){const t=document.createElement("div");t.classList.add("square"),s.appendChild(t)}}}function L(t,e){for(let n=0;n<t.length;n++)t[n].isSunk&&e.querySelector(`.ship[data-id="${n}"`).classList.add("ship--sunk")}function k(t,e,n){n.classList.contains("cell--sunk")||(n.classList.add("cell--cleared"),n.classList.contains("cell--ship")?(n.classList.add("cell--sunk"),e.filter((t=>function(t,e){const n=t.getAttribute("data-x"),s=t.getAttribute("data-y"),i=e.getAttribute("data-x"),a=e.getAttribute("data-y");return Math.abs(+n-+i)<=1&&Math.abs(+s-+a)<=1}(n,t))).forEach((n=>k(t,e,n)))):n.classList.contains("water")||n.classList.add("water"))}c=S,d=new WeakMap,h=new WeakMap,l=new WeakSet,f=function t(e,n){const s=w(this,h,"f")[e][n];if(!s.isClear&&(s.isFog=!1,s.isClear=!0,s.shipId>=0))for(const s of w(this,l,"m",p).call(this,e,n))w(this,l,"m",t).call(this,s.x,s.y)},p=function(t,e){const n=[];return t>0&&n.push({x:t-1,y:e}),t<w(S,c,"f",u)-1&&n.push({x:t+1,y:e}),e>0&&n.push({x:t,y:e-1}),e<w(S,c,"f",u)-1&&n.push({x:t,y:e+1}),t>0&&e>0&&n.push({x:t-1,y:e-1}),t>0&&e<w(S,c,"f",u)-1&&n.push({x:t-1,y:e+1}),t<w(S,c,"f",u)-1&&e<w(S,c,"f",u)-1&&n.push({x:t+1,y:e+1}),t<w(S,c,"f",u)-1&&e>0&&n.push({x:t+1,y:e-1}),n},m=function(t,e,n,s){const i="horizontal"===s;if(i&&e+t.length>w(S,c,"f",u)||!i&&n+t.length>w(S,c,"f",u))return!1;for(let s=-1;s<=t.length;s++)for(let t=-1;t<=1;t++){let a;try{a=i?w(this,h,"f")[e+s][n+t]:w(this,h,"f")[e+t][n+s]}catch(t){continue}if((null==a?void 0:a.shipId)>=0)return!1}return!0},y=function(t,e){if(t<0||e<0||t>=w(S,c,"f",u)||e>=w(S,c,"f",u))throw new Error(`Invalid coordinate: ${t}, ${e}`)},u={value:10};const b=document.querySelector("#player-side"),x=document.querySelector("#player-board"),A=document.querySelector("#player-ships");let E;function M(t){t?b.classList.add("transparent"):b.classList.remove("transparent")}const z=document.getElementById("display"),C=document.getElementById("game-state");function I(t){null==z||z.classList.remove("display--won"),null==z||z.classList.remove("display--lost"),C.textContent=t}function T(t){"Player"===t?(C.textContent="You won!",null==z||z.classList.add("display--won")):(C.textContent="You lost!",null==z||z.classList.add("display--lost"))}const q=document.querySelector("#computer-side"),P=document.querySelector("#computer-board"),$=document.querySelector("#computer-ships");let F,W;function j(t){t?q.classList.add("transparent"):q.classList.remove("transparent")}function B(t){W=t,q.setAttribute("data-active",""+t)}function H(t){const e=t.target;var n,s;W&&!e.classList.contains("cell--cleared")&&(n=+e.getAttribute("data-x"),s=+e.getAttribute("data-y"),O.attack(n,s),function(t,e,n){(function(t,e,n){const s=t.getState(e,n),i=function(t,e){return F.find((n=>n.getAttribute("data-x")===""+t&&n.getAttribute("data-y")===""+e))}(e,n);"hit"!==s&&"sunk"!==s||(i.classList.add("cell--ship"),"sunk"===s&&k(t,F,i)),"water"===s&&i.classList.add("water"),i.classList.add("cell--cleared")})(t,e,n),L(t.ships,$)}(O,n,s),O.allAreSunk?U():function(){M(!1),j(!0),B(!1),I("Computer turn");const t=function(t){const e=[];let n=-1/0;for(let s=0;s<S.Size;s++)for(let i=0;i<S.Size;i++)if("fog"===t.getState(s,i)){const a=Y(t,s,i);n=Math.max(n,a),e.push({x:s,y:i,evaluation:a})}return e.filter((t=>t.evaluation===n)).map((({x:t,y:e})=>({x:t,y:e})))}(N),{x:e,y:n}=function(t){const e=t.length-1,n=t[Math.round(Math.random()*e)];return{x:n.x,y:n.y}}(t);(function(t,e,n){t.attack(e,n),t.allAreSunk&&U()})(N,e,n),function(t,e,n){!function(t,e,n){const s=function(t,e){return E.find((n=>n.getAttribute("data-x")===""+t&&n.getAttribute("data-y")===""+e))}(e,n),i=t.getState(e,n);"hit"===i||"sunk"===i?(s.classList.add("cell--ship"),s.classList.add("cell--player"),"sunk"===i&&k(t,E,s)):"water"===i&&s.classList.add("water"),s.classList.add("cell--cleared")}(t,e,n),L(t.ships,A)}(N,e,n),N.allAreSunk?U():(M(!0),j(!1),B(!0),I("Player turn"))}())}function Y(t,e,n){return function(t,e,n){const s=Math.min(...G(t));return function(t,e,n){return e>0&&n>0&&J(t,e-1,n-1)||e>0&&n<S.Size-1&&J(t,e-1,n+1)||n>0&&e<S.Size-1&&J(t,e+1,n-1)||e<S.Size-1&&n<S.Size-1&&J(t,e+1,n+1)}(t,e,n)||0===D(t,e,n,s)}(t,e,n)?-1/0:function(t,e,n){return e>0&&J(t,e-1,n)||n>0&&J(t,e,n-1)||e<S.Size-1&&J(t,e+1,n)||n<S.Size-1&&J(t,e,n+1)}(t,e,n)?1/0:function(t,e,n){let s=0;for(const i of G(t))s+=D(t,e,n,i)*i;return s}(t,e,n)}function D(t,e,n,s){if(s<o.minLength||s>o.maxLength)throw new Error("Length out of bounds: "+s);const i=Math.max(0,e-s+1),a=Math.max(0,n-s+1),r=Math.min(9,e+s-1),l=Math.min(9,n+s-1);let c=0,u=0;for(let e=i;e<=r;e++){const s=t.getState(e,n);"fog"===s||"hit"===s?c=++u>c?u:c:u=0}const d=Math.max(0,c-s+1);c=0,u=0;for(let n=a;n<=l;n++){const s=t.getState(e,n);"fog"===s||"hit"===s?c=++u>c?u:c:u=0}const h=Math.max(0,c-s+1);return Math.max(0,d+h)}function G(t){return t.ships.filter((t=>!t.isSunk)).map((t=>t.length))}function J(t,e,n){return"hit"===t.getState(e,n)}const K=[5,4,3,3,2,2];let N,O;const Q=document.getElementById("start-over");function R(){N=new S,O=new S,N.randomize(K),O.randomize(K),function(t){x.innerHTML="";for(let e=0;e<S.Size;e++)for(let n=0;n<S.Size;n++){const s=document.createElement("div");s.classList.add("cell"),s.setAttribute("data-x",""+n),s.setAttribute("data-y",""+e),t.isShip(n,e)&&(s.classList.add("cell--ship"),s.classList.add("cell--player")),null==x||x.appendChild(s)}v(t.ships,A),b.classList.add("transparent"),E=Array.from(x.querySelectorAll(".cell"))}(N),function(t){P.innerHTML="";for(let t=0;t<S.Size;t++)for(let e=0;e<S.Size;e++){const n=document.createElement("div");n.classList.add("cell"),n.setAttribute("data-x",""+e),n.setAttribute("data-y",""+t),n.addEventListener("click",H),null==P||P.appendChild(n)}v(t.ships,$),q.setAttribute("data-active","true"),W=!0,F=Array.from(P.querySelectorAll(".cell"))}(O),I("Player turn")}function U(){if(N.allAreSunk&&O.allAreSunk)throw Error("Indecisive game result");O.allAreSunk&&T("Player"),N.allAreSunk&&T("Computer"),B(!1),M(!1),j(!1)}null==Q||Q.addEventListener("click",(()=>R())),R()})();
//# sourceMappingURL=main.973cd3b7ff6783831ccf.js.map
(()=>{"use strict";var t,e,i,n,s,a=function(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)},r=function(t,e,i,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(t,i):s?s.value=i:e.set(t,i),i};class o{static get minLength(){return a(o,t,"f",e)}static get maxLength(){return a(o,t,"f",i)}constructor(l){if(n.set(this,void 0),s.set(this,void 0),l<a(o,t,"f",e)||l>a(o,t,"f",i))throw new Error("Ship length out of bounds: "+l);r(this,n,l,"f"),r(this,s,0,"f")}get length(){return a(this,n,"f")}get isSunk(){return a(this,n,"f")<=a(this,s,"f")}hit(){var t;this.isSunk||r(this,s,(t=a(this,s,"f"),++t),"f")}}t=o,n=new WeakMap,s=new WeakMap,e={value:1},i={value:5};var l,c,h,u,d,f,p,m,w,g=function(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)},y=function(t,e,i,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(t,i):s?s.value=i:e.set(t,i),i};class v{static get Size(){return g(v,c,"f",h)}constructor(){l.add(this),u.set(this,void 0),d.set(this,void 0),y(this,u,[],"f"),y(this,d,[],"f");for(let t=0;t<g(v,c,"f",h);t++){const t=[];for(let e=0;e<g(v,c,"f",h);e++)t.push({shipId:-1,isFog:!0,isClear:!1});g(this,d,"f").push(t)}}get ships(){return g(this,u,"f")}get allAreSunk(){return g(this,u,"f").every((t=>t.isSunk))}randomize(t){for(const e of t){const t=new o(e);let i,n,s;do{i=Math.round(9*Math.random()),n=Math.round(9*Math.random()),s=Math.random()>.5?"horizontal":"vertical"}while(!g(this,l,"m",m).call(this,t,i,n,s));this.place(t,i,n,s)}}isShip(t,e){return g(this,d,"f")[t][e].shipId>=0}getState(t,e){g(this,l,"m",w).call(this,t,e);const i=g(this,d,"f")[t][e];return i.isFog?"fog":-1===i.shipId?"water":g(this,u,"f")[i.shipId].isSunk?"sunk":"hit"}place(t,e,i,n){if(g(this,l,"m",w).call(this,e,i),!g(this,l,"m",m).call(this,t,e,i,n))throw new Error(`Invalid ship placement: ${e}, ${i}`);g(this,u,"f").push(t);const s=g(this,u,"f").length-1;for(let a=0;a<t.length;a++)"horizontal"===n?g(this,d,"f")[e+a][i].shipId=s:g(this,d,"f")[e][i+a].shipId=s}attack(t,e){g(this,l,"m",w).call(this,t,e);const i=g(this,d,"f")[t][e];if(!i.isFog)throw new Error(`Cell already received an attack: ${t}, ${e}`);if(i.isFog=!1,i.shipId<0)return;const n=g(this,u,"f")[i.shipId];n.hit(),n.isSunk&&g(this,l,"m",f).call(this,t,e)}}function S(t,e,i){return function(t,e,i){const n=Math.min(...k(t));return function(t,e,i){return e>0&&i>0&&b(t,e-1,i-1)||e>0&&i<v.Size-1&&b(t,e-1,i+1)||i>0&&e<v.Size-1&&b(t,e+1,i-1)||e<v.Size-1&&i<v.Size-1&&b(t,e+1,i+1)}(t,e,i)||0===L(t,e,i,n)}(t,e,i)?-1/0:function(t,e,i){return e>0&&b(t,e-1,i)||i>0&&b(t,e,i-1)||e<v.Size-1&&b(t,e+1,i)||i<v.Size-1&&b(t,e,i+1)}(t,e,i)?1/0:function(t,e,i){let n=0;for(const s of k(t))n+=L(t,e,i,s)*s;return n}(t,e,i)}function L(t,e,i,n){if(n<o.minLength||n>o.maxLength)throw new Error("Length out of bounds: "+n);const s=Math.max(0,e-n+1),a=Math.max(0,i-n+1),r=Math.min(9,e+n-1),l=Math.min(9,i+n-1);let c=0,h=0;for(let e=s;e<=r;e++){const n=t.getState(e,i);"fog"===n||"hit"===n?c=++h>c?h:c:h=0}const u=Math.max(0,c-n+1);c=0,h=0;for(let i=a;i<=l;i++){const n=t.getState(e,i);"fog"===n||"hit"===n?c=++h>c?h:c:h=0}const d=Math.max(0,c-n+1);return Math.max(0,u+d)}function k(t){return t.ships.filter((t=>!t.isSunk)).map((t=>t.length))}function b(t,e,i){return"hit"===t.getState(e,i)}function x(t,e){e.innerHTML="";for(let i=0;i<t.length;i++){const n=document.createElement("div");n.classList.add("ship"),n.setAttribute("data-id",""+i),e.appendChild(n);for(let e=0;e<t[i].length;e++){const t=document.createElement("div");t.classList.add("square"),n.appendChild(t)}}}function A(t,e){for(let i=0;i<t.length;i++)t[i].isSunk&&e.querySelector(`.ship[data-id="${i}"`).classList.add("ship--sunk")}function E(t,e,i){i.classList.contains("cell--sunk")||(i.classList.add("cell--cleared"),i.classList.remove("cell--clickable"),i.classList.contains("cell--hit")?(i.classList.add("cell--sunk"),e.filter((t=>function(t,e){const i=t.getAttribute("data-x"),n=t.getAttribute("data-y"),s=e.getAttribute("data-x"),a=e.getAttribute("data-y");return Math.abs(+i-+s)<=1&&Math.abs(+n-+a)<=1}(i,t))).forEach((i=>E(t,e,i)))):i.classList.contains("water")||i.classList.add("cell--water"))}c=v,u=new WeakMap,d=new WeakMap,l=new WeakSet,f=function t(e,i){const n=g(this,d,"f")[e][i];if(!n.isClear&&(n.isFog=!1,n.isClear=!0,n.shipId>=0))for(const n of g(this,l,"m",p).call(this,e,i))g(this,l,"m",t).call(this,n.x,n.y)},p=function(t,e){const i=[];return t>0&&i.push({x:t-1,y:e}),t<g(v,c,"f",h)-1&&i.push({x:t+1,y:e}),e>0&&i.push({x:t,y:e-1}),e<g(v,c,"f",h)-1&&i.push({x:t,y:e+1}),t>0&&e>0&&i.push({x:t-1,y:e-1}),t>0&&e<g(v,c,"f",h)-1&&i.push({x:t-1,y:e+1}),t<g(v,c,"f",h)-1&&e<g(v,c,"f",h)-1&&i.push({x:t+1,y:e+1}),t<g(v,c,"f",h)-1&&e>0&&i.push({x:t+1,y:e-1}),i},m=function(t,e,i,n){const s="horizontal"===n;if(s&&e+t.length>g(v,c,"f",h)||!s&&i+t.length>g(v,c,"f",h))return!1;for(let n=-1;n<=t.length;n++)for(let t=-1;t<=1;t++){let a;try{a=s?g(this,d,"f")[e+n][i+t]:g(this,d,"f")[e+t][i+n]}catch(t){continue}if((null==a?void 0:a.shipId)>=0)return!1}return!0},w=function(t,e){if(t<0||e<0||t>=g(v,c,"f",h)||e>=g(v,c,"f",h))throw new Error(`Invalid coordinate: ${t}, ${e}`)},h={value:10};const M=document.querySelector("#player-board"),z=document.querySelector("#player-ships");let I;const C=document.querySelector("#computer-board"),T=document.querySelector("#computer-ships");let q;function $(t){const e=t.target;var i,n;e.classList.contains("cell--clickable")&&(i=+e.getAttribute("data-x"),n=+e.getAttribute("data-y"),H.attack(i,n),function(t,e,i){(function(t,e,i){const n=t.getState(e,i),s=function(t,e){return q.find((i=>i.getAttribute("data-x")===""+t&&i.getAttribute("data-y")===""+e))}(e,i);"hit"!==n&&"sunk"!==n||(s.classList.add("cell--hit"),"sunk"===n&&E(t,q,s)),"water"===n&&s.classList.add("cell--water"),s.classList.add("cell--cleared"),s.classList.remove("cell--clickable")})(t,e,i),A(t.ships,T)}(H,i,n),H.allAreSunk?Y():function(){const t=function(t){const e=[];let i=-1/0;for(let n=0;n<v.Size;n++)for(let s=0;s<v.Size;s++)if("fog"===t.getState(n,s)){const a=S(t,n,s);i=Math.max(i,a),e.push({x:n,y:s,evaluation:a})}return e.filter((t=>t.evaluation===i)).map((({x:t,y:e})=>({x:t,y:e})))}(j),{x:e,y:i}=function(t){const e=t.length-1,i=t[Math.round(Math.random()*e)];return{x:i.x,y:i.y}}(t);(function(t,e,i){t.attack(e,i),t.allAreSunk&&Y()})(j,e,i),function(t,e,i){!function(t,e,i){const n=function(t,e){return I.find((i=>i.getAttribute("data-x")===""+t&&i.getAttribute("data-y")===""+e))}(e,i),s=t.getState(e,i);"hit"===s||"sunk"===s?(n.classList.add("cell--hit"),n.classList.add("cell--player"),"sunk"===s&&E(t,I,n)):"water"===s&&n.classList.add("cell--water"),n.classList.add("cell--cleared")}(t,e,i),A(t.ships,z)}(j,e,i),j.allAreSunk&&Y()}())}const P=document.getElementById("result"),F=document.getElementById("new-game");null==F||F.addEventListener("click",B);const W=[5,4,3,3,2,2];let j,H;function B(){j=new v,H=new v,j.randomize(W),H.randomize(W),function(t){M.innerHTML="";for(let e=0;e<v.Size;e++)for(let i=0;i<v.Size;i++){const n=document.createElement("div");n.classList.add("cell"),n.setAttribute("data-x",""+i),n.setAttribute("data-y",""+e),t.isShip(i,e)&&(n.classList.add("cell--ship"),n.classList.add("cell--player")),null==M||M.appendChild(n)}x(t.ships,z),I=Array.from(M.querySelectorAll(".cell"))}(j),function(t){C.innerHTML="";for(let t=0;t<v.Size;t++)for(let e=0;e<v.Size;e++){const i=document.createElement("div");i.classList.add("cell"),i.setAttribute("data-x",""+e),i.setAttribute("data-y",""+t),i.classList.add("cell--clickable"),i.addEventListener("click",$),null==C||C.appendChild(i)}x(t.ships,T),q=Array.from(C.querySelectorAll(".cell"))}(H),F.classList.add("hidden"),P.classList.add("hidden")}function Y(){if(j.allAreSunk&&H.allAreSunk)throw Error("Indecisive game result");var t;q.forEach((t=>t.classList.remove("cell--clickable"))),t=H.allAreSunk,F.classList.remove("hidden"),P.classList.remove("hidden"),P.textContent=t?"You won!":"You lost!"}B()})();
//# sourceMappingURL=main.d6c397f2aa215a0f16dd.js.map
(()=>{"use strict";var t,e,a,s,r,i=function(t,e,a,s){if("a"===a&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===a?s:"a"===a?s.call(t):s?s.value:e.get(t)},n=function(t,e,a,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(t,a):r?r.value=a:e.set(t,a),a};class o{constructor(l){if(s.set(this,void 0),r.set(this,void 0),l<i(o,t,"f",e)||l>i(o,t,"f",a))throw new Error("Ship length out of bounds");n(this,s,l,"f"),n(this,r,0,"f")}get length(){return i(this,s,"f")}get isSunk(){return i(this,s,"f")<=i(this,r,"f")}hit(){var t;this.isSunk||n(this,r,(t=i(this,r,"f"),++t),"f")}}t=o,s=new WeakMap,r=new WeakMap,e={value:1},a={value:5};var l,c,d,u,h,f,p,m=function(t,e,a,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(t,a):r?r.value=a:e.set(t,a),a},w=function(t,e,a,s){if("a"===a&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===a?s:"a"===a?s.call(t):s?s.value:e.get(t)};class y{constructor(){l.add(this),u.set(this,void 0),h.set(this,void 0),m(this,u,[],"f"),m(this,h,[],"f");for(let t=0;t<w(y,c,"f",d);t++){const t=[];for(let e=0;e<w(y,c,"f",d);e++)t.push({shipId:-1,gotAttacked:!1});w(this,h,"f").push(t)}}get ships(){return w(this,u,"f")}get allAreSunk(){return 0!==w(this,u,"f").length&&0===w(this,u,"f").filter((t=>!t.isSunk)).length}randomize(t){for(const e of t){const t=new o(e);let a,s,r;do{a=Math.round(9*Math.random()),s=Math.round(9*Math.random()),r=Math.random()>.5?"horizontal":"vertical"}while(!w(this,l,"m",f).call(this,t,a,s,r));this.place(t,a,s,r)}}isShip(t,e){return w(this,h,"f")[t][e].shipId>=0}gotAttacked(t,e){return w(this,h,"f")[t][e].gotAttacked}place(t,e,a,s){if(w(this,l,"m",p).call(this,e,a),!w(this,l,"m",f).call(this,t,e,a,s))throw new Error("Invalid ship placement");w(this,u,"f").push(t);const r=w(this,u,"f").length-1;for(let i=0;i<t.length;i++)"horizontal"===s?w(this,h,"f")[e+i][a].shipId=r:w(this,h,"f")[e][a+i].shipId=r}attack(t,e){w(this,l,"m",p).call(this,t,e);const a=w(this,h,"f")[t][e];if(a.gotAttacked)throw new Error(`Cell already received an attack: ${t}, ${e}`);if(a.gotAttacked=!0,a.shipId>=0){const t=w(this,u,"f")[a.shipId];return t.hit(),{isShip:!0,isSunk:t.isSunk}}return{isShip:!1,isSunk:!1}}}function v(t,e){e.innerHTML="";for(let a=0;a<t.length;a++){const s=document.createElement("div");s.classList.add("ship"),s.setAttribute("data-id",""+a),e.appendChild(s);for(let e=0;e<t[a].length;e++){const t=document.createElement("div");t.classList.add("square"),s.appendChild(t)}}}function g(t,e){for(let a=0;a<t.length;a++)t[a].isSunk&&e.querySelector(`.ship[data-id="${a}"`).classList.add("ship--sunk")}function k(t,e,a){var s;if(!a.classList.contains("cell--sunk"))if(a.classList.contains("cell--ship"))a.classList.add("cell--sunk"),e.filter((t=>function(t,e){const a=t.getAttribute("data-x"),s=t.getAttribute("data-y"),r=e.getAttribute("data-x"),i=e.getAttribute("data-y");return Math.abs(+a-+r)<=1&&Math.abs(+s-+i)<=1}(a,t))).forEach((a=>k(t,e,a)));else if(!a.classList.contains("water")){a.classList.add("water");const e={x:+(s=a).getAttribute("data-x"),y:+s.getAttribute("data-y")},r=t.attack(e.x,e.y);if(r.isShip||r.isSunk)throw Error("Uncovered unexpected ship")}}c=y,u=new WeakMap,h=new WeakMap,l=new WeakSet,f=function(t,e,a,s){const r="horizontal"===s;if(r&&e+t.length>w(y,c,"f",d)||!r&&a+t.length>w(y,c,"f",d))return!1;for(let s=-1;s<=t.length;s++)for(let t=-1;t<=1;t++){let i;try{i=r?w(this,h,"f")[e+s][a+t]:w(this,h,"f")[e+t][a+s]}catch(t){continue}if((null==i?void 0:i.shipId)>=0)return!1}return!0},p=function(t,e){if(t<0||e<0||t>=w(y,c,"f",d)||e>=w(y,c,"f",d))throw new Error(`Invalid coordinate: ${t}, ${e}`)},d={value:10};const L=document.querySelector("#player-side"),b=document.querySelector("#player-board"),A=document.querySelector("#player-ships");let S,E;function M(){return S.allAreSunk}function q(t){t?L.classList.add("opaque"):L.classList.remove("opaque")}const C=document.getElementById("display"),T=document.getElementById("game-state");function x(t){null==C||C.classList.remove("display--won"),null==C||C.classList.remove("display--lost"),T.textContent=t}function I(t){"Player"===t?(T.textContent="You won!",null==C||C.classList.add("display--won")):(T.textContent="You lost!",null==C||C.classList.add("display--lost"))}const P=document.querySelector("#computer-side"),z=document.querySelector("#computer-board"),W=document.querySelector("#computer-ships");let $,j;function B(){return $.allAreSunk}function H(t){t?P.classList.add("opaque"):P.classList.remove("opaque")}function Y(t){P.setAttribute("data-active",""+t)}function U(t){const e=t.target;if("false"===P.getAttribute("data-active")||e.classList.contains("cell--attacked"))return;const a=e.getAttribute("data-x"),s=e.getAttribute("data-y"),r=$.attack(+a,+s);r.isShip?(e.classList.add("cell--ship"),r.isSunk&&k($,j,e)):e.classList.add("water"),e.classList.add("cell--attacked"),g($.ships,W),$.allAreSunk?J():(q(!1),H(!0),Y(!1),x("Computer turn"),setTimeout((()=>{F=function(){let t,e;do{t=Math.round(9*Math.random()),e=Math.round(9*Math.random())}while(S.gotAttacked(t,e));const a=function(t,e){const a=function(t,e){return E.find((a=>a.getAttribute("data-x")===""+t&&a.getAttribute("data-y")===""+e))}(t,e),s=S.attack(+t,+e);return s.isShip?(a.classList.add("cell--ship"),a.classList.add("cell--player"),s.isSunk&&k(S,E,a)):a.classList.add("water"),a.classList.add("cell--attacked"),S.allAreSunk}(t,e);return g(S.ships,A),a}(),F?J():(q(!0),H(!1),Y(!0),x("Player turn"))}),1500*Math.random()))}const D=document.getElementById("start-over");let F=!1;function G(){const t=[5,4,3,3,2,2];!function(t){b.innerHTML="",S=new y,S.randomize(t);for(let t=0;t<10;t++)for(let e=0;e<10;e++){const a=document.createElement("div");a.classList.add("cell"),a.setAttribute("data-x",""+e),a.setAttribute("data-y",""+t),S.isShip(e,t)&&(a.classList.add("cell--ship"),a.classList.add("cell--player")),null==b||b.appendChild(a)}v(S.ships,A),L.classList.add("opaque"),E=Array.from(b.querySelectorAll(".cell"))}(t),function(t){z.innerHTML="",$=new y,$.randomize(t);for(let t=0;t<10;t++)for(let e=0;e<10;e++){const a=document.createElement("div");a.classList.add("cell"),a.setAttribute("data-x",""+e),a.setAttribute("data-y",""+t),a.addEventListener("click",U),null==z||z.appendChild(a)}v($.ships,W),P.setAttribute("data-active","true"),j=Array.from(z.querySelectorAll(".cell"))}(t),x("Player turn")}function J(){if(B()&&M())throw Error("Indecisive game result");B()&&(I("Player"),Y(!1)),M()&&I("Computer")}null==D||D.addEventListener("click",(()=>G())),G()})();
//# sourceMappingURL=main.a1953c106f0021a61019.js.map
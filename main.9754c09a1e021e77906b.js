(()=>{"use strict";var t,e,n,r,i,s=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},a=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};class o{constructor(l){if(r.set(this,void 0),i.set(this,void 0),l<s(o,t,"f",e)||l>s(o,t,"f",n))throw new Error("Ship length out of bounds");a(this,r,l,"f"),a(this,i,0,"f")}get length(){return s(this,r,"f")}get isSunk(){return s(this,r,"f")<=s(this,i,"f")}hit(){var t;this.isSunk||a(this,i,(t=s(this,i,"f"),++t),"f")}}t=o,r=new WeakMap,i=new WeakMap,e={value:1},n={value:5};var l,c,u,d,h,f,p,y=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},m=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};class w{static get Size(){return y(w,c,"f",u)}constructor(){l.add(this),d.set(this,void 0),h.set(this,void 0),m(this,d,[],"f"),m(this,h,[],"f");for(let t=0;t<y(w,c,"f",u);t++){const t=[];for(let e=0;e<y(w,c,"f",u);e++)t.push({shipId:-1,gotAttacked:!1});y(this,h,"f").push(t)}}get ships(){return y(this,d,"f")}get allAreSunk(){return 0!==y(this,d,"f").length&&0===y(this,d,"f").filter((t=>!t.isSunk)).length}randomize(t){for(const e of t){const t=new o(e);let n,r,i;do{n=Math.round(9*Math.random()),r=Math.round(9*Math.random()),i=Math.random()>.5?"horizontal":"vertical"}while(!y(this,l,"m",f).call(this,t,n,r,i));this.place(t,n,r,i)}}isShip(t,e){return y(this,h,"f")[t][e].shipId>=0}getState(t,e){y(this,l,"m",p).call(this,t,e);const n=y(this,h,"f")[t][e];return n.gotAttacked?-1===n.shipId?"miss":y(this,d,"f")[n.shipId].isSunk?"sunk":"hit":"unknown"}place(t,e,n,r){if(y(this,l,"m",p).call(this,e,n),!y(this,l,"m",f).call(this,t,e,n,r))throw new Error("Invalid ship placement");y(this,d,"f").push(t);const i=y(this,d,"f").length-1;for(let s=0;s<t.length;s++)"horizontal"===r?y(this,h,"f")[e+s][n].shipId=i:y(this,h,"f")[e][n+s].shipId=i}attack(t,e){y(this,l,"m",p).call(this,t,e);const n=y(this,h,"f")[t][e];if(n.gotAttacked)throw new Error(`Cell already received an attack: ${t}, ${e}`);if(n.gotAttacked=!0,n.shipId>=0){const t=y(this,d,"f")[n.shipId];return t.hit(),{isShip:!0,isSunk:t.isSunk}}return{isShip:!1,isSunk:!1}}}c=w,d=new WeakMap,h=new WeakMap,l=new WeakSet,f=function(t,e,n,r){const i="horizontal"===r;if(i&&e+t.length>y(w,c,"f",u)||!i&&n+t.length>y(w,c,"f",u))return!1;for(let r=-1;r<=t.length;r++)for(let t=-1;t<=1;t++){let s;try{s=i?y(this,h,"f")[e+r][n+t]:y(this,h,"f")[e+t][n+r]}catch(t){continue}if((null==s?void 0:s.shipId)>=0)return!1}return!0},p=function(t,e){if(t<0||e<0||t>=y(w,c,"f",u)||e>=y(w,c,"f",u))throw new Error(`Invalid coordinate: ${t}, ${e}`)},u={value:10};const v=w.Size-1;function g(t,e,n){return function(t,e,n){return e>0&&n>0&&S(t,{x:e-1,y:n-1})||e>0&&n<v&&S(t,{x:e-1,y:n+1})||n>0&&e<v&&S(t,{x:e+1,y:n-1})||e<v&&n<v&&S(t,{x:e+1,y:n+1})}(t,e,n)?-1:function(t,e,n){return e>0&&S(t,{x:e-1,y:n})||n>0&&S(t,{x:e,y:n-1})||e<v&&S(t,{x:e+1,y:n})||n<v&&S(t,{x:e,y:n+1})}(t,e,n)?100:1}function S(t,e){return"hit"===t.getState(e.x,e.y)}function k(t,e){e.innerHTML="";for(let n=0;n<t.length;n++){const r=document.createElement("div");r.classList.add("ship"),r.setAttribute("data-id",""+n),e.appendChild(r);for(let e=0;e<t[n].length;e++){const t=document.createElement("div");t.classList.add("square"),r.appendChild(t)}}}function L(t,e){for(let n=0;n<t.length;n++)t[n].isSunk&&e.querySelector(`.ship[data-id="${n}"`).classList.add("ship--sunk")}function b(t,e,n){var r;if(!n.classList.contains("cell--sunk"))if(n.classList.contains("cell--ship"))n.classList.add("cell--sunk"),e.filter((t=>function(t,e){const n=t.getAttribute("data-x"),r=t.getAttribute("data-y"),i=e.getAttribute("data-x"),s=e.getAttribute("data-y");return Math.abs(+n-+i)<=1&&Math.abs(+r-+s)<=1}(n,t))).forEach((n=>b(t,e,n)));else if(!n.classList.contains("water")){n.classList.add("water");const e={x:+(r=n).getAttribute("data-x"),y:+r.getAttribute("data-y")},i=t.attack(e.x,e.y);if(i.isShip||i.isSunk)throw Error("Uncovered unexpected ship")}}const A=document.querySelector("#player-side"),x=document.querySelector("#player-board"),E=document.querySelector("#player-ships");let M,I;function z(){return M.allAreSunk}function C(t){t?A.classList.add("transparent"):A.classList.remove("transparent")}const T=document.getElementById("display"),q=document.getElementById("game-state");function P(t){null==T||T.classList.remove("display--won"),null==T||T.classList.remove("display--lost"),q.textContent=t}function W(t){"Player"===t?(q.textContent="You won!",null==T||T.classList.add("display--won")):(q.textContent="You lost!",null==T||T.classList.add("display--lost"))}const $=document.querySelector("#computer-side"),j=document.querySelector("#computer-board"),B=document.querySelector("#computer-ships");let H,Y;function U(){return H.allAreSunk}function D(t){t?$.classList.add("transparent"):$.classList.remove("transparent")}function F(t){$.setAttribute("data-active",""+t)}function G(t){const e=t.target;if("false"===$.getAttribute("data-active")||e.classList.contains("cell--attacked"))return;const n=e.getAttribute("data-x"),r=e.getAttribute("data-y"),i=H.attack(+n,+r);i.isShip?(e.classList.add("cell--ship"),i.isSunk&&b(H,Y,e)):e.classList.add("water"),e.classList.add("cell--attacked"),L(H.ships,B),H.allAreSunk?O():(C(!1),D(!0),F(!1),P("Computer turn"),setTimeout((()=>{K=function(){const t=function(t){const e=[];let n=-1;for(let r=0;r<w.Size;r++)for(let i=0;i<w.Size;i++)if("unknown"===t.getState(r,i)){const s=g(t,r,i);s>n&&(n=s),e.push({x:r,y:i,value:s})}return e.filter((t=>t.value===n)).map((({x:t,y:e})=>({x:t,y:e})))}(M),{x:e,y:n}=function(t){const e=t.length-1,n=t[Math.round(Math.random()*e)];return{x:n.x,y:n.y}}(t),r=function(t,e){const n=function(t,e){return I.find((n=>n.getAttribute("data-x")===""+t&&n.getAttribute("data-y")===""+e))}(t,e),r=M.attack(+t,+e);return r.isShip?(n.classList.add("cell--ship"),n.classList.add("cell--player"),r.isSunk&&b(M,I,n)):n.classList.add("water"),n.classList.add("cell--attacked"),M.allAreSunk}(e,n);return L(M.ships,E),r}(),K?O():(C(!0),D(!1),F(!0),P("Player turn"))}),1500*Math.random()))}const J=document.getElementById("start-over");let K=!1;function N(){const t=[5,4,3,3,2,2];!function(t){x.innerHTML="",M=new w,M.randomize(t);for(let t=0;t<w.Size;t++)for(let e=0;e<w.Size;e++){const n=document.createElement("div");n.classList.add("cell"),n.setAttribute("data-x",""+e),n.setAttribute("data-y",""+t),M.isShip(e,t)&&(n.classList.add("cell--ship"),n.classList.add("cell--player")),null==x||x.appendChild(n)}k(M.ships,E),A.classList.add("transparent"),I=Array.from(x.querySelectorAll(".cell"))}(t),function(t){j.innerHTML="",H=new w,H.randomize(t);for(let t=0;t<w.Size;t++)for(let e=0;e<w.Size;e++){const n=document.createElement("div");n.classList.add("cell"),n.setAttribute("data-x",""+e),n.setAttribute("data-y",""+t),n.addEventListener("click",G),null==j||j.appendChild(n)}k(H.ships,B),$.setAttribute("data-active","true"),Y=Array.from(j.querySelectorAll(".cell"))}(t),P("Player turn")}function O(){if(U()&&z())throw Error("Indecisive game result");U()&&W("Player"),z()&&W("Computer"),F(!1),C(!1),D(!1)}null==J||J.addEventListener("click",(()=>N())),N()})();
//# sourceMappingURL=main.9754c09a1e021e77906b.js.map
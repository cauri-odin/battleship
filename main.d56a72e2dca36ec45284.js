(()=>{"use strict";var t,e,i,a,s,r=function(t,e,i,a){if("a"===i&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?a:"a"===i?a.call(t):a?a.value:e.get(t)},n=function(t,e,i,a,s){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?s.call(t,i):s?s.value=i:e.set(t,i),i};class o{constructor(l){if(a.set(this,void 0),s.set(this,void 0),l<r(o,t,"f",e)||l>r(o,t,"f",i))throw new Error("Ship length out of bounds");n(this,a,l,"f"),n(this,s,0,"f")}get length(){return r(this,a,"f")}get isSunk(){return r(this,a,"f")<=r(this,s,"f")}hit(){var t;this.isSunk||n(this,s,(t=r(this,s,"f"),++t),"f")}}t=o,a=new WeakMap,s=new WeakMap,e={value:1},i={value:5};var l,c,d,h,u,f,p,w=function(t,e,i,a,s){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?s.call(t,i):s?s.value=i:e.set(t,i),i},m=function(t,e,i,a){if("a"===i&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?a:"a"===i?a.call(t):a?a.value:e.get(t)};class g{constructor(){l.add(this),h.set(this,void 0),u.set(this,void 0),w(this,h,[],"f"),w(this,u,[],"f");for(let t=0;t<m(g,c,"f",d);t++){const t=[];for(let e=0;e<m(g,c,"f",d);e++)t.push({shipId:-1,gotAttacked:!1});m(this,u,"f").push(t)}}get ships(){return m(this,h,"f")}get allAreSunk(){return 0!==m(this,h,"f").length&&0===m(this,h,"f").filter((t=>!t.isSunk)).length}randomize(t){for(const e of t){const t=new o(e);let i,a,s;do{i=Math.round(9*Math.random()),a=Math.round(9*Math.random()),s=Math.random()>.5?"horizontal":"vertical"}while(!m(this,l,"m",f).call(this,t,i,a,s));this.place(t,i,a,s)}}isShip(t,e){return m(this,u,"f")[t][e].shipId>=0}gotAttacked(t,e){return m(this,u,"f")[t][e].gotAttacked}place(t,e,i,a){if(m(this,l,"m",p).call(this,e,i),!m(this,l,"m",f).call(this,t,e,i,a))throw new Error("Invalid ship placement");m(this,h,"f").push(t);const s=m(this,h,"f").length-1;for(let r=0;r<t.length;r++)"horizontal"===a?m(this,u,"f")[e+r][i].shipId=s:m(this,u,"f")[e][i+r].shipId=s}attack(t,e){m(this,l,"m",p).call(this,t,e);const i=m(this,u,"f")[t][e];if(i.gotAttacked)throw new Error(`Cell already received an attack: ${t}, ${e}`);if(i.gotAttacked=!0,i.shipId>=0){const t=m(this,h,"f")[i.shipId];return t.hit(),{isShip:!0,isSunk:t.isSunk}}return{isShip:!1,isSunk:!1}}}function v(t,e){e.innerHTML="";for(let i=0;i<t.length;i++){const a=document.createElement("div");a.classList.add("ship"),a.setAttribute("data-id",""+i),e.appendChild(a);for(let e=0;e<t[i].length;e++){const t=document.createElement("div");t.classList.add("square"),a.appendChild(t)}}}function y(t,e){for(let i=0;i<t.length;i++)t[i].isSunk&&e.querySelector(`.ship[data-id="${i}"`).classList.add("ship--sunk")}function k(t,e,i){var a;if(!i.classList.contains("cell--sunk"))if(i.classList.contains("cell--ship"))i.classList.add("cell--sunk"),e.filter((t=>function(t,e){const i=t.getAttribute("data-x"),a=t.getAttribute("data-y"),s=e.getAttribute("data-x"),r=e.getAttribute("data-y");return Math.abs(+i-+s)<=1&&Math.abs(+a-+r)<=1}(i,t))).forEach((i=>k(t,e,i)));else if(!i.classList.contains("water")){i.classList.add("water");const e={x:+(a=i).getAttribute("data-x"),y:+a.getAttribute("data-y")},s=t.attack(e.x,e.y);if(s.isShip||s.isSunk)throw Error("Uncovered unexpected ship")}}c=g,h=new WeakMap,u=new WeakMap,l=new WeakSet,f=function(t,e,i,a){const s="horizontal"===a;if(s&&e+t.length>m(g,c,"f",d)||!s&&i+t.length>m(g,c,"f",d))return!1;for(let a=-1;a<=t.length;a++)for(let t=-1;t<=1;t++){let r;try{r=s?m(this,u,"f")[e+a][i+t]:m(this,u,"f")[e+t][i+a]}catch(t){continue}if((null==r?void 0:r.shipId)>=0)return!1}return!0},p=function(t,e){if(t<0||e<0||t>=m(g,c,"f",d)||e>=m(g,c,"f",d))throw new Error(`Invalid coordinate: ${t}, ${e}`)},d={value:10};const L=document.querySelector("#player-board"),S=document.querySelector("#player-ships");let b,A;function E(){return b.allAreSunk}function M(){for(const t of A)t.classList.toggle("cell--inactive");S.classList.toggle("ships--inactive")}const T=document.getElementById("game-state");function C(t){T.textContent=t}const I=document.querySelector("#computer-board"),x=document.querySelector("#computer-ships");let P,q;function z(){return P.allAreSunk}function W(){for(const t of q)t.classList.toggle("cell--inactive");x.classList.toggle("ships--inactive")}function $(t){const e=t.target;if(e.classList.contains("cell--inactive")||e.classList.contains("cell--attacked"))return;const i=e.getAttribute("data-x"),a=e.getAttribute("data-y"),s=P.attack(+i,+a);s.isShip?(e.classList.add("cell--ship"),s.isSunk&&k(P,q,e)):e.classList.add("water"),e.classList.add("cell--attacked"),y(P.ships,x),P.allAreSunk?U():(M(),W(),C("Computer turn"),setTimeout((()=>{H=function(){let t,e;do{t=Math.round(9*Math.random()),e=Math.round(9*Math.random())}while(b.gotAttacked(t,e));const i=function(t,e){const i=function(t,e){return A.find((i=>i.getAttribute("data-x")===""+t&&i.getAttribute("data-y")===""+e))}(t,e),a=b.attack(+t,+e);return a.isShip?(i.classList.add("cell--ship"),i.classList.add("cell--player"),a.isSunk&&k(b,A,i)):i.classList.add("water"),i.classList.add("cell--attacked"),b.allAreSunk}(t,e);return y(b.ships,S),i}(),H?U():(M(),W(),C("Player turn"))}),1500*Math.random()))}const j=document.getElementById("start-over");let H=!1;function B(){const t=[5,4,3,3,2,2];!function(t){L.innerHTML="",b=new g,b.randomize(t);for(let t=0;t<10;t++)for(let e=0;e<10;e++){const i=document.createElement("div");i.classList.add("cell"),i.classList.add("cell--inactive"),i.setAttribute("data-x",""+e),i.setAttribute("data-y",""+t),b.isShip(e,t)&&(i.classList.add("cell--ship"),i.classList.add("cell--player")),null==L||L.appendChild(i)}v(b.ships,S),S.classList.add("ships--inactive"),A=Array.from(L.querySelectorAll(".cell"))}(t),function(t){I.innerHTML="",P=new g,P.randomize(t);for(let t=0;t<10;t++)for(let e=0;e<10;e++){const i=document.createElement("div");i.classList.add("cell"),i.setAttribute("data-x",""+e),i.setAttribute("data-y",""+t),i.addEventListener("click",$),null==I||I.appendChild(i)}v(P.ships,x),q=Array.from(I.querySelectorAll(".cell"))}(t),C("Player turn")}function U(){if(z()&&E())throw Error("Indecisive game result");z()&&C("Player won!"),E()&&C("Computer won!")}null==j||j.addEventListener("click",(()=>B())),B()})();
//# sourceMappingURL=main.d56a72e2dca36ec45284.js.map